Building...
[DEBUG] Application starting at 2026-01-27 12:23:27 UTC
[DEBUG] Current directory: c:\Users\RuffAli\puppy-az\back-api\src\PetWebsite.API
[DEBUG] Environment: Development
[DEBUG] Process ID: 33632
[DEBUG] Adding Application layer...
[DEBUG] Adding Infrastructure layer...
[DEBUG-INFRA] Starting Infrastructure registration...
[DEBUG-INFRA] AuditableEntityInterceptor registered
[DEBUG-INFRA] Connection string: Host=Host=127.0.0.1...
[DEBUG-INFRA] DbContext registration complete
[DEBUG] Infrastructure layer added successfully
[DEBUG] Building application...
[DEBUG] Application built successfully
[DEBUG] Controllers mapped
[DEBUG] Health check endpoints mapped
[DEBUG] Starting application run loop...
dbug: Microsoft.Extensions.Hosting.Internal.Host[1]
      Hosting starting
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5005
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: c:\Users\RuffAli\puppy-az\back-api\src\PetWebsite.API
[DEBUG] Application STARTED at 2026-01-27 12:23:28 UTC
dbug: Microsoft.Extensions.Hosting.Internal.Host[2]
      Hosting started
info: PetWebsite.API.Middleware.RequestResponseLoggingMiddleware[0]
      [2b6d7cc4] HTTP Request Information:
      Method: GET
      Path: /api/pet-ads/categories/detailed?localeCode=az
      Host: localhost:5005
      Content-Type: N/A
      Content-Length: N/A
      
info: PetWebsite.Infrastructure.Localization.JsonStringLocalizer[0]
      Loaded localization for culture: az
info: PetWebsite.Infrastructure.Localization.JsonStringLocalizer[0]
      Loaded localization for culture: en
info: PetWebsite.Infrastructure.Localization.JsonStringLocalizer[0]
      Loaded localization for culture: ru
[DEBUG-INFRA] Configuring DbContext...
[DEBUG-INFRA] DbContext configured with PostgreSQL
dbug: Microsoft.EntityFrameworkCore.Infrastructure[10401]
      An 'IServiceProvider' was created for internal use by Entity Framework.
info: PetWebsite.Infrastructure.Localization.JsonStringLocalizer[0]
      Loaded localization for culture: az
info: PetWebsite.Infrastructure.Localization.JsonStringLocalizer[0]
      Loaded localization for culture: en
info: PetWebsite.Infrastructure.Localization.JsonStringLocalizer[0]
      Loaded localization for culture: ru
dbug: PetWebsite.API.Controllers.Pets.PetAdsController[0]
      [API] GetPetCategoriesDetailed called. LocaleCode: az, AcceptLanguage: 
info: PetWebsite.Application.Common.Behaviors.LoggingBehavior[0]
      Handling GetPetCategoriesDetailedQuery
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Starting query. RequestLocale: az
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Using culture: az
dbug: Microsoft.EntityFrameworkCore.Model[10607]
      No relationship from 'Conversation' to 'User' has been configured by convention because there are multiple properties on one entity type - {'Initiator', 'Owner'} that could be matched with the properties on the other entity type - {'InitiatedConversations', 'ReceivedConversations'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
dbug: Microsoft.EntityFrameworkCore.Model[10607]
      No relationship from 'Conversation' to 'User' has been configured by convention because there are multiple properties on one entity type - {'Initiator', 'Owner'} that could be matched with the properties on the other entity type - {'InitiatedConversations', 'ReceivedConversations'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
dbug: Microsoft.EntityFrameworkCore.Model[10607]
      No relationship from 'User' to 'Conversation' has been configured by convention because there are multiple properties on one entity type - {'InitiatedConversations', 'ReceivedConversations'} that could be matched with the properties on the other entity type - {'Initiator', 'Owner'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
dbug: Microsoft.EntityFrameworkCore.Model[10607]
      No relationship from 'Conversation' to 'User' has been configured by convention because there are multiple properties on one entity type - {'Initiator', 'Owner'} that could be matched with the properties on the other entity type - {'InitiatedConversations', 'ReceivedConversations'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
dbug: Microsoft.EntityFrameworkCore.Model[10607]
      No relationship from 'User' to 'Conversation' has been configured by convention because there are multiple properties on one entity type - {'InitiatedConversations', 'ReceivedConversations'} that could be matched with the properties on the other entity type - {'Initiator', 'Owner'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'UserId'} was not created on entity type 'IdentityUserRole<Guid>' as the properties are already covered by the index {'UserId', 'RoleId'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'UserId'} was not created on entity type 'IdentityUserToken<Guid>' as the properties are already covered by the index {'UserId', 'LoginProvider', 'Name'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'PetAdId'} was not created on entity type 'Conversation' as the properties are already covered by the index {'PetAdId', 'InitiatorId', 'OwnerId'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'UserId'} was not created on entity type 'FavoriteAd' as the properties are already covered by the index {'UserId', 'PetAdId'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'UploadedById'} was not created on entity type 'PetAdImage' as the properties are already covered by the index {'UploadedById', 'PetAdId'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'QuestionId'} was not created on entity type 'PetAdQuestionReply' as the properties are already covered by the index {'QuestionId', 'CreatedAt'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'UserId'} was not created on entity type 'PetAdView' as the properties are already covered by the index {'UserId', 'PetAdId'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'UserId'} was not created on entity type 'PetAdView' as the properties are already covered by the index {'UserId', 'ViewedAt'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'PetBreedId'} was not created on entity type 'PetBreedLocalization' as the properties are already covered by the index {'PetBreedId', 'AppLocaleId'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'PetCategoryId'} was not created on entity type 'PetCategoryLocalization' as the properties are already covered by the index {'PetCategoryId', 'AppLocaleId'}.
dbug: Microsoft.EntityFrameworkCore.Model[10601]
      The index {'PetColorId'} was not created on entity type 'PetColorLocalization' as the properties are already covered by the index {'PetColorId', 'AppLocaleId'}.
warn: Microsoft.EntityFrameworkCore.Model.Validation[10622]
      Entity 'PetAd' has a global query filter defined and is the required end of a relationship with the entity 'Conversation'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[10622]
      Entity 'PetAdQuestion' has a global query filter defined and is the required end of a relationship with the entity 'PetAdQuestionReply'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
warn: Microsoft.EntityFrameworkCore.Model.Validation[10400]
      Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
dbug: Microsoft.EntityFrameworkCore.Infrastructure[10403]
      Entity Framework Core 8.0.11 initialized 'ApplicationDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.11+52a6b9f2ddd23fcabd1c673b4a2e273495129481' with options: SensitiveDataLoggingEnabled DetailedErrorsEnabled MigrationsAssembly=PetWebsite.Infrastructure, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null 
dbug: Microsoft.EntityFrameworkCore.Query[10111]
      Compiling query expression: 
      'DbSet<PetCategory>()
          .Where(e => !(e.IsDeleted))
          .Where(c => c.IsActive)
          .AsNoTracking()
          .OrderBy(c => c.Id == 10 ? 1 : 0)
          .ThenBy(c => c.Id)
          .Select(c => new PetCategoryDetailedDto{ 
              Id = c.Id, 
              Title = c.Localizations
                  .Where(l => l.AppLocale.Code == __currentCulture_0 || l.AppLocale.IsDefault)
                  .OrderByDescending(l => l.AppLocale.Code == __currentCulture_0)
                  .Select(l => l.Title)
                  .FirstOrDefault() ?? "", 
              Subtitle = c.Localizations
                  .Where(l => l.AppLocale.Code == __currentCulture_0 || l.AppLocale.IsDefault)
                  .OrderByDescending(l => l.AppLocale.Code == __currentCulture_0)
                  .Select(l => l.Subtitle)
                  .FirstOrDefault() ?? "", 
              SvgIcon = c.SvgIcon, 
              IconColor = c.IconColor, 
              BackgroundColor = c.BackgroundColor, 
              PetAdsCount = c.Breeds
                  .SelectMany(b => b.PetAds)
                  .Count(a => (int)a.Status == 1 && !(a.IsDeleted)) 
          }
          )'
dbug: Microsoft.EntityFrameworkCore.Query[10107]
      Generated query execution expression: 
      'queryContext => new SingleQueryingEnumerable<PetCategoryDetailedDto>(
          (RelationalQueryContext)queryContext, 
          RelationalCommandCache.QueryExpression(
              Projection Mapping:
                  Id -> 0
                  Title -> 1
                  Subtitle -> 2
                  SvgIcon -> 3
                  IconColor -> 4
                  BackgroundColor -> 5
                  PetAdsCount -> 6
              SELECT p.Id, COALESCE((
                  SELECT TOP(1) p0.Title
                  FROM PetCategoryLocalizations AS p0
                  INNER JOIN AppLocales AS a ON p0.AppLocaleId == a.Id
                  WHERE ((p.Id != NULL) && (p.Id == p0.PetCategoryId)) && ((a.Code == @__currentCulture_0) || a.IsDefault)
                  ORDER BY a.Code == @__currentCulture_0 DESC), '') AS Title, COALESCE((
                  SELECT TOP(1) p1.Subtitle
                  FROM PetCategoryLocalizations AS p1
                  INNER JOIN AppLocales AS a0 ON p1.AppLocaleId == a0.Id
                  WHERE ((p.Id != NULL) && (p.Id == p1.PetCategoryId)) && ((a0.Code == @__currentCulture_0) || a0.IsDefault)
                  ORDER BY a0.Code == @__currentCulture_0 DESC), '') AS Subtitle, p.SvgIcon, p.IconColor, p.BackgroundColor, (
                  SELECT CAST(count(*) AS integer)
                  FROM PetBreeds AS p2
                  INNER JOIN 
                  (
                      SELECT p3.Id, p3.AdType, p3.AgeInMonths, p3.CityId, p3.Color, p3.CreatedAt, p3.CreatedBy, p3.DeletedAt, p3.DeletedBy, p3.Description, p3.ExpiresAt, p3.Gender, p3.IsAvailable, p3.IsDeleted, p3.IsPremium, p3.PetBreedId, p3.PremiumActivatedAt, p3.PremiumExpiresAt, p3.Price, p3.PublishedAt, p3.RejectionReason, p3.Size, p3.Status, p3.Title, p3.UpdatedAt, p3.UpdatedBy, p3.UserId, p3.ViewCount, p3.Weight
                      FROM PetAds AS p3
                      WHERE Not(p3.IsDeleted)
                  ) AS t ON p2.Id == t.PetBreedId
                  WHERE (Not(p2.IsDeleted) && ((p.Id != NULL) && (p.Id == p2.PetCategoryId))) && ((t.Status == 1) && Not(t.IsDeleted))) AS PetAdsCount
              FROM PetCategories AS p
              WHERE (Not(p.IsDeleted) && Not(p.IsDeleted)) && p.IsActive
              ORDER BY CASE
                  WHEN p.Id == 10 THEN 1
                  ELSE 0
              END ASC, p.Id ASC), 
          null, 
          Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, PetCategoryDetailedDto>, 
          PetWebsite.Infrastructure.Persistence.ApplicationDbContext, 
          False, 
          True, 
          True
      )'
dbug: Microsoft.EntityFrameworkCore.Database.Connection[20005]
      Creating DbConnection.
dbug: Microsoft.EntityFrameworkCore.Database.Connection[20006]
      Created DbConnection. (34ms).
dbug: Microsoft.EntityFrameworkCore.Database.Connection[20000]
      Opening connection to database 'PetWebsiteDb' on server 'tcp://127.0.0.1:5433'.
dbug: Microsoft.EntityFrameworkCore.Database.Connection[20001]
      Opened connection to database 'PetWebsiteDb' on server 'tcp://127.0.0.1:5433'.
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (102ms) [Parameters=[@__currentCulture_0='az'], CommandType='Text', CommandTimeout='30']
      SELECT p."Id", COALESCE((
          SELECT p0."Title"
          FROM "PetCategoryLocalizations" AS p0
          INNER JOIN "AppLocales" AS a ON p0."AppLocaleId" = a."Id"
          WHERE p."Id" = p0."PetCategoryId" AND (a."Code" = @__currentCulture_0 OR a."IsDefault")
          ORDER BY a."Code" = @__currentCulture_0 DESC
          LIMIT 1), '') AS "Title", COALESCE((
          SELECT p1."Subtitle"
          FROM "PetCategoryLocalizations" AS p1
          INNER JOIN "AppLocales" AS a0 ON p1."AppLocaleId" = a0."Id"
          WHERE p."Id" = p1."PetCategoryId" AND (a0."Code" = @__currentCulture_0 OR a0."IsDefault")
          ORDER BY a0."Code" = @__currentCulture_0 DESC
          LIMIT 1), '') AS "Subtitle", p."SvgIcon", p."IconColor", p."BackgroundColor", (
          SELECT count(*)::int
          FROM "PetBreeds" AS p2
          INNER JOIN (
              SELECT p3."Id", p3."AdType", p3."AgeInMonths", p3."CityId", p3."Color", p3."CreatedAt", p3."CreatedBy", p3."DeletedAt", p3."DeletedBy", p3."Description", p3."ExpiresAt", p3."Gender", p3."IsAvailable", p3."IsDeleted", p3."IsPremium", p3."PetBreedId", p3."PremiumActivatedAt", p3."PremiumExpiresAt", p3."Price", p3."PublishedAt", p3."RejectionReason", p3."Size", p3."Status", p3."Title", p3."UpdatedAt", p3."UpdatedBy", p3."UserId", p3."ViewCount", p3."Weight"
              FROM "PetAds" AS p3
              WHERE NOT (p3."IsDeleted")
          ) AS t ON p2."Id" = t."PetBreedId"
          WHERE NOT (p2."IsDeleted") AND p."Id" = p2."PetCategoryId" AND t."Status" = 1 AND NOT (t."IsDeleted")) AS "PetAdsCount"
      FROM "PetCategories" AS p
      WHERE NOT (p."IsDeleted") AND NOT (p."IsDeleted") AND p."IsActive"
      ORDER BY CASE
          WHEN p."Id" = 10 THEN 1
          ELSE 0
      END, p."Id"
dbug: Microsoft.EntityFrameworkCore.Database.Connection[20002]
      Closing connection to database 'PetWebsiteDb' on server 'tcp://127.0.0.1:5433'.
dbug: Microsoft.EntityFrameworkCore.Database.Connection[20003]
      Closed connection to database 'PetWebsiteDb' on server 'tcp://127.0.0.1:5433' (4ms).
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Query completed. Found 10 categories
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 1: Title='İtlər', AdsCount=38
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 2: Title='Pişiklər', AdsCount=33
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 3: Title='Quşlar', AdsCount=25
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 4: Title='Balıqlar', AdsCount=23
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 5: Title='Sürünənlər', AdsCount=33
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 6: Title='Həşəratlar', AdsCount=17
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 7: Title='Ferma heyvanları', AdsCount=32
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 8: Title='Gəmiricilər', AdsCount=23
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 9: Title='Vəhşi heyvanlar', AdsCount=17
dbug: PetWebsite.Application.Features.PetAds.Queries.GetPetCategoriesDetailed.GetPetCategoriesDetailedQueryHandler[0]
      [GetPetCategoriesDetailed] Category 10: Title='Digər', AdsCount=159
warn: PetWebsite.Application.Common.Behaviors.LoggingBehavior[0]
      GetPetCategoriesDetailedQuery completed in 2239ms (slow)
dbug: PetWebsite.API.Controllers.Pets.PetAdsController[0]
      [API] GetPetCategoriesDetailed result - IsSuccess: True, Count: 10
info: PetWebsite.API.Middleware.RequestResponseLoggingMiddleware[0]
      [2b6d7cc4] HTTP Response Information:
      Status Code: 200
      Content-Type: application/json; charset=utf-8
      Content-Length: 3595
      Elapsed Time: 2580ms
      Body: [{"svgIcon":"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M11 5h2\"/><path d=\"M19 12c-.667 5.333 -2.333 8 -5 8h-4c-2.667 0 -4.333 -2.667 -5 -8\"/></svg>","iconColor":"text-amber-600","backgroundColor":"bg-amber-50","petAdsCount":38,"id":1,"title":"İtlər","subtitle":"Sadiq dostlar"},{"svgIcon":"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M20 3v10a8 8 0 1 1 -16 0v-10l3.432 3.432\"/></svg>","iconColor":"text-purple-600","backgroundColor":"bg-purple-50","petAdsCount":33,"id":2,"title":"Pişiklər","subtitle":"Müstəqil yoldaşlar"},{"svgIcon":"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 20l10 -10m0 -5v5h5\"/></svg>","iconColor":"text-sky-600","backgroundColor":"bg-sky-50","petAd... (truncated, total: 3557 chars)
      
dbug: Microsoft.EntityFrameworkCore.Infrastructure[10407]
      'ApplicationDbContext' disposed.
dbug: Microsoft.EntityFrameworkCore.Database.Connection[20007]
      Disposing connection to database 'PetWebsiteDb' on server 'tcp://127.0.0.1:5433'.
dbug: Microsoft.EntityFrameworkCore.Database.Connection[20008]
      Disposed connection to database 'PetWebsiteDb' on server 'tcp://127.0.0.1:5433' (1ms).
info: PetWebsite.API.Middleware.RequestResponseLoggingMiddleware[0]
      [a7725996] HTTP Request Information:
      Method: GET
      Path: /api/pet-ads
      Host: localhost:5005
      Content-Type: N/A
      Content-Length: N/A
      
[DEBUG-INFRA] Configuring DbContext...
[DEBUG-INFRA] DbContext configured with PostgreSQL
warn: PetWebsite.API.Middleware.RequestResponseLoggingMiddleware[0]
      [a7725996] HTTP Response Information:
      Status Code: 405
      Content-Type: application/problem+json
      Content-Length: 207
      Elapsed Time: 28ms
      Body: {"type":"https://tools.ietf.org/html/rfc9110#section-15.5.6","title":"Method Not Allowed","status":405,"instance":"/api/pet-ads","traceId":"0HNITJRMKAN6S:00000002","timestamp":"2026-01-27T12:24:48.3575606Z"}
      
